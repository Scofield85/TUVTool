{
    "collab_server" : "",
    "contents" : "rm(list=ls())\nsource(\"./src/config.R\")\nsource(\"./src/Triaxus_class.R\")\nsource(\"./src/preprocessing.R\")\nsource(\"./src/interpolation.R\")\nsource(\"./src/hotspot.R\")\nsource(\"./src/clustering.R\")\nsource(\"./src/plot.R\")\nsource(\"./src/misc.R\")\nlibrary(RColorBrewer)\nlibrary(leaflet)\nlibrary(ggplot2)\noptions(rgl.useNULL=FALSE)\nlibrary(rgl)\n\noutputFolder <- \"../output/\"\n\n\nmain<- function(newfile,oldResult,seabirdIndex,bbeIndex,seabird_cutoff,newResult=FALSE){\n\tmyTriaxus <- new(\"Base_Triaxus\",config,newfile,seabirdIndex,bbeIndex,seabird_cutoff)\n\tprint(newfile)\n\tmyTriaxus <- preprocessing(myTriaxus) %>% interpolation_main(int_method=\"krige\",det_method=\"tps\") %>% hotspot_main() \n  \t\n  \tif(newResult | !file.exists(oldResult)) {\n\t\tprint(\"creating new File\")\n\t\tallTriaxus <- list()\n\t\tallTriaxus[[myTriaxus@pathName]] <- myTriaxus\n\t\tsaveRDS(allTriaxus,oldResult)\n\t}\n\telse{\n\t\tallTriaxus <- readRDS(oldResult)\n\t\tallTriaxus[[myTriaxus@pathName]] <- myTriaxus\n\t\tsaveRDS(allTriaxus,oldResult)\n\t}\n\t# \n}\n\ncalculate <- function(){\n\toldResult <- \"../output/Manitowoc.rds\"\n\tsystem.time(main(\"../input/Manitowoc_01.csv\",oldResult,409,371,c(850,-1),TRUE))\n\tsystem.time(main(\"../input/Manitowoc_02.csv\",oldResult,3106,3067,c(3140,9352)))\n\tsystem.time(main(\"../input/Manitowoc_03.csv\",oldResult,6409,6370,c(3120,6360)))\n\tsystem.time(main(\"../input/Manitowoc_04.csv\",oldResult,244,207,c(1,3311)))\n\tsystem.time(main(\"../input/Manitowoc_05.csv\",oldResult,0,0,c(1930,8630)))\n\tallTriaxus <- clustering_main(readRDS(oldResult),c(\"Seabird_temperature\",\"Spec.Cond\"),Ks=c(2,3,4,5,6))\n\tsaveRDS(allTriaxus,\"../output/Manitowoc_Results.rds\")\n\trm(allTriaxus)\n\n\toldResult <- \"../output/Muskegon.rds\"\n\tsystem.time(main(\"../input/Muskegon River_01.csv\",oldResult,7267,7228,c(1930,7200),TRUE))\n\tsystem.time(main(\"../input/Muskegon River_02.csv\",oldResult,2017,1980,c(1880,-1)))\n\tsystem.time(main(\"../input/Muskegon River_03a.csv\",oldResult,120,81,c(150,6745)))\n\tsystem.time(main(\"../input/Muskegon River_04a.csv\",oldResult,377,338,c(1400,6614)))\n\tallTriaxus <- clustering_main(readRDS(oldResult),c(\"Seabird_temperature\",\"Spec.Cond\"),Ks=c(2,3,4,5,6))\n\tsaveRDS(allTriaxus,\"../output/Muskegon_Results.rds\")\n\trm(allTriaxus)\n\n\toldResult <- \"../output/Pere.rds\"\n\tsystem.time(main(\"../input/Pere Marquette River_01.csv\",oldResult,5828,5789,c(200,3260,3780,7450),TRUE))\n\tsystem.time(main(\"../input/Pere Marquette River_02.csv\",oldResult,513,473,c(350,4705)))\n\tsystem.time(main(\"../input/Pere Marquette River_03.csv\",oldResult,2138,2100,c(2200,8637)))\n\tsystem.time(main(\"../input/Pere Marquette River_04.csv\",oldResult,833,794,c(2000,8299)))\n\tsystem.time(main(\"../input/Pere Marquette River_05.csv\",oldResult,6806,6769,c(3030,7999)))\n\tsystem.time(main(\"../input/Pere Marquette River_06.csv\",oldResult,3654,3615,c(360,5100)))\n\tallTriaxus <- clustering_main(readRDS(oldResult),c(\"Seabird_temperature\",\"Spec.Cond\"),Ks=c(2,3,4,5,6))\n\tsaveRDS(allTriaxus,\"../output/Pere_Results.rds\")\n\trm(allTriaxus)\n}\n\npaper_plot <- function(){\n\t# Manitowoc\n\ttransmatrix=matrix(c(0.01585434,-0.68476230,-0.72859418, 0.00000000,0.4700032, 0.6482660,-0.5990396,0.0000000,0.8825220,-0.3329444,0.3321184,0,0,0,0,1),nrow=4,ncol=4)\n\triverMouth <- list(c(-87.5600,44.1425),c(-87.6436,44.0900))\n\t#plot_3d_clustering(readRDS(\"../output/Manitowoc_Results.rds\"),3,transmatrix=transmatrix,riverMouth=riverMouth)\n\tpaperPlotSub(\"../output/Manitowoc_Results.rds\",transmatrix,riverMouth,3)\n\n\n\t\n\ttransmatrix=matrix(c(0.0670390948653221 , -0.821753919124603 , -0.565885365009308 , 0 , -0.435517132282257 , 0.486176699399948 , -0.757599711418152 , 0 , 0.897680580615997 , 0.297241151332855 , -0.325294703245163 , 0 , 0 , 0 , 0 , 1),nrow=4,ncol=4)\n\triverMouth <- list(c(-86.33,43.22))\n\t#plot_3d_clustering(readRDS(\"../output/Muskegon_Results.rds\"),3,transmatrix=transmatrix,riverMouth=riverMouth)\n\tpaperPlotSub(\"../output/Muskegon_Results.rds\",transmatrix,riverMouth,3)\n\n\t# Pere\n\ttransmatrix=matrix(c(-0.02324756 , -0.68113685 , -0.731787025928497 , 0 , -0.583894312381744 , 0.603414714336395 , -0.543100714683533 , 0 , 0.811497092247009 , 0.41466024518013 , -0.411739528179169 , 0 , 0 , 0 , 0 , 1),nrow=4,ncol=4)\n\triverMouth <- list(c(-86.46,43.95))\n\t#plot_3d_clustering(readRDS(\"../output/Pere_Results.rds\"),2,transmatrix=transmatrix,riverMouth=riverMouth)\n\tpaperPlotSub(\"../output/Pere_Results.rds\",transmatrix,riverMouth,2)\n}\n\npaperPlotSub <- function(triaxusFile,transmatrix,riverMouth,K){\n\tlocationName <- strsplit(basename(triaxusFile),\"_\")[[1]][1]\n\tprint(locationName)\n\tallTriaxus <- readRDS(triaxusFile)\n\tfor(var in config$interestVar){\n\t\tprint(var)\n\n\t\tplot_3d_value(allTriaxus,var,transmatrix=transmatrix,riverMouth=riverMouth)\n\t\trgl.snapshot(paste(outputFolder,locationName,var,\"value.png\",sep=\"_\"))\n    \trgl.close()\n\n\t\t# postscript()\n\t\tplot_3d_hotspot(allTriaxus,var,transmatrix=transmatrix,riverMouth=riverMouth)\n\t\trgl.snapshot(paste(outputFolder,locationName,var,\"hotspot.png\",sep=\"_\"))\n    \trgl.close()\n\t}\n\n\t# print silhouetter width\n\n\twrite.csv(x=as.data.frame(allTriaxus[[1]]@clusteringResults$silhouetteList),file=paste(outputFolder,locationName,\"clusterSil.csv\",sep=\"_\"))\n\t# plot clustering analysis\n\tplot_3d_clustering(allTriaxus,K,transmatrix=transmatrix,riverMouth=riverMouth)\n\trgl.snapshot(paste(outputFolder,locationName,\"cluster.png\",sep=\"_\"))\n    rgl.close()\n\t\n\t# print boxplot\n\tpdf(paste(outputFolder,locationName,K,\"boxplot.pdf\",sep=\"_\"),height=2.75,width=3.25)\n\tplot_boxplot(allTriaxus,config$interestVar[1:8],K)\n\tdev.off()\n}\n\n#calculate()\npaper_plot()\n",
    "created" : 1460497315663.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "648552366",
    "id" : "8CDAB70B",
    "lastKnownWriteTime" : 1460519193,
    "last_content_update" : 1460519193007,
    "path" : "~/Developer/Triaxus/TriaxusCode/main.R",
    "project_path" : "main.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}